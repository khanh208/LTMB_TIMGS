Tuyá»‡t vá»i. ÄÃ¢y lÃ  má»™t tÃ i liá»‡u API hoÃ n chá»‰nh cho dá»± Ã¡n MentorMatch, bao gá»“m cÃ¡c lá»‡nh cURL, cÃ¡c output (pháº£n há»“i) máº«u, vÃ  hÆ°á»›ng dáº«n logic Ä‘á»ƒ báº¡n Ã¡p dá»¥ng trá»±c tiáº¿p vÃ o á»©ng dá»¥ng Flutter.
________________


ğŸš€ HÆ°á»›ng dáº«n Nhanh (Quan trá»ng)


Táº¥t cáº£ cÃ¡c API yÃªu cáº§u xÃ¡c thá»±c (trá»« ÄÄƒng nháº­p, ÄÄƒng kÃ½, vÃ  API cÃ´ng khai) Ä‘á»u cáº§n má»™t JWT Token.
1. Cháº¡y API "ÄÄƒng nháº­p" (Má»¥c 1.2) Ä‘á»ƒ láº¥y token.
2. Copy chuá»—i token Ä‘Ã³.
3. Thay tháº¿ YOUR_JWT_TOKEN trong táº¥t cáº£ cÃ¡c lá»‡nh cURL bÃªn dÆ°á»›i báº±ng token báº¡n vá»«a copy.
________________


1. ğŸ”‘ API XÃ¡c thá»±c (Auth)


Quáº£n lÃ½ Ä‘Äƒng nháº­p, Ä‘Äƒng kÃ½, vÃ  quÃªn máº­t kháº©u.


1.1. POST /api/auth/register


* MÃ´ táº£: ÄÄƒng kÃ½ má»™t ngÆ°á»i dÃ¹ng má»›i (Há»c viÃªn hoáº·c Gia sÆ°). API sáº½ tá»± Ä‘á»™ng táº¡o Wallet vÃ  TutorProfile (náº¿u lÃ  Gia sÆ°).
* XÃ¡c thá»±c: KhÃ´ng cáº§n.
Request (cURL):


Bash




curl -X POST http://localhost:3000/api/auth/register \
-H "Content-Type: application/json" \
-d '{
   "email": "hocvien.moi@email.com",
   "password": "password123",
   "fullName": "Hoc Vien Moi",
   "role": "student"
}'

Output (Success 201):


JSON




{
   "user": {
       "user_id": 5,
       "email": "hocvien.moi@email.com",
       "full_name": "Hoc Vien Moi",
       "phone_number": null,
       "avatar_url": null,
       "role": "student",
       "created_at": "2025-11-15T08:30:00.000Z"
   },
   "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
   "message": "ÄÄƒng kÃ½ thÃ nh cÃ´ng!"
}

Output (Failure 400):


JSON




{
   "message": "Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng."
}

Logic Flutter:
* Sá»­ dá»¥ng trong register_screen.dart.
* Khi ngÆ°á»i dÃ¹ng Ä‘iá»n form vÃ  báº¥m "ÄÄƒng kÃ½", gá»i ApiService.register().
* Hiá»ƒn thá»‹ _isLoading = true (vÃ²ng xoay).
* Náº¿u thÃ nh cÃ´ng, hiá»ƒn thá»‹ SnackBar "ÄÄƒng kÃ½ thÃ nh cÃ´ng" vÃ  Ä‘iá»u hÆ°á»›ng vá» /login.
* Náº¿u tháº¥t báº¡i, hiá»ƒn thá»‹ SnackBar lá»—i (vÃ­ dá»¥: "Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng.").


1.2. POST /api/auth/login


* MÃ´ táº£: ÄÄƒng nháº­p vÃ  nháº­n vá» JWT Token Ä‘á»ƒ sá»­ dá»¥ng cho cÃ¡c API khÃ¡c.
* XÃ¡c thá»±c: KhÃ´ng cáº§n.
Request (cURL):


Bash




curl -X POST http://localhost:3000/api/auth/login \
-H "Content-Type: application/json" \
-d '{
   "email": "hocvien.a@email.com",
   "password": "password_cua_hocvien_a"
}'

Output (Success 200):


JSON




{
   "user": {
       "user_id": 1,
       "email": "hocvien.a@email.com",
       "full_name": "Há»c ViÃªn A",
       "role": "student"
   },
   "token": "YOUR_JWT_TOKEN",
   "message": "ÄÄƒng nháº­p thÃ nh cÃ´ng!"
}

Output (Failure 401):


JSON




{
   "message": "Email hoáº·c máº­t kháº©u khÃ´ng chÃ­nh xÃ¡c."
}

Logic Flutter:
* Sá»­ dá»¥ng trong login_screen.dart.
* Khi báº¥m "ÄÄƒng nháº­p", gá»i ApiService.login().
* Náº¿u thÃ nh cÃ´ng:
   1. LÆ°u token: DÃ¹ng shared_preferences.setString('token', token).
   2. (NÃªn lÃ m) LÆ°u thÃ´ng tin user vÃ o má»™t state (Provider/Bloc) toÃ n cá»¥c.
   3. Äiá»u hÆ°á»›ng Ä‘áº¿n /main (mÃ n hÃ¬nh chÃ­nh).
* Náº¿u tháº¥t báº¡i, hiá»ƒn thá»‹ SnackBar lá»—i.
________________


2. ğŸ‘¤ API NgÆ°á»i dÃ¹ng (User)


Quáº£n lÃ½ thÃ´ng tin cÃ¡ nhÃ¢n (chung) vÃ  cÃ¡c tÃ­nh nÄƒng cá»§a Há»c viÃªn.


2.1. GET /api/users/me


* MÃ´ táº£: Láº¥y thÃ´ng tin tÃ i khoáº£n (TÃªn, Email, SÄT...) cá»§a chÃ­nh ngÆ°á»i dÃ¹ng Ä‘ang Ä‘Äƒng nháº­p.
* XÃ¡c thá»±c: Bearer Token Required.
Request (cURL):
Bash


curl http://localhost:3000/api/users/me \
-H "Authorization: Bearer YOUR_JWT_TOKEN"

Output (Success 200):
JSON


{
   "user_id": 1,
   "email": "hocvien.a@email.com",
   "full_name": "Há»c ViÃªn A",
   "phone_number": "090111222",
   "avatar_url": null,
   "role": "student",
   "created_at": "2025-11-15T08:00:00.000Z"
}

Logic Flutter:
* Sá»­ dá»¥ng trong my_profile_screen.dart.
* Gá»i API nÃ y trong initState() Ä‘á»ƒ táº£i vÃ  hiá»ƒn thá»‹ TÃªn, Email, Avatar á»Ÿ Ä‘áº§u mÃ n hÃ¬nh Há»“ sÆ¡.
* Dá»¯ liá»‡u nÃ y cÅ©ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ "Ä‘á»“ng bá»™" vÃ  Ä‘iá»n vÃ o form trong edit_account_screen.dart.
2.2. PUT /api/users/me
* MÃ´ táº£: Cáº­p nháº­t thÃ´ng tin cÆ¡ báº£n (TÃªn, SÄT, Avatar) cá»§a ngÆ°á»i dÃ¹ng Ä‘ang Ä‘Äƒng nháº­p.
* XÃ¡c thá»±c: Bearer Token Required.
Request (cURL):
Bash
curl -X PUT http://localhost:3000/api/users/me \
-H "Authorization: Bearer YOUR_JWT_TOKEN" \
-H "Content-Type: application/json" \
-d '{
   "fullName": "Hoc Vien A (Updated)",
   "phoneNumber": "0987654321"
}'

Output (Success 200):
JSON
{
   "user_id": 1,
   "full_name": "Hoc Vien A (Updated)",
   "phone_number": "0987654321",
   "avatar_url": null
   
}

Logic Flutter:
* Sá»­ dá»¥ng trong edit_account_screen.dart.
* Khi báº¥m nÃºt "LÆ°u" (biá»ƒu tÆ°á»£ng Check), gá»i API nÃ y vá»›i dá»¯ liá»‡u tá»« cÃ¡c TextEditingController.
* Náº¿u thÃ nh cÃ´ng, cáº­p nháº­t láº¡i state (Provider/Bloc) vÃ  Navigator.pop() Ä‘á»ƒ quay láº¡i.
2.3. GET /api/users/wallet
* MÃ´ táº£: Láº¥y sá»‘ dÆ° vÃ­ cá»§a ngÆ°á»i dÃ¹ng Ä‘ang Ä‘Äƒng nháº­p.
* XÃ¡c thá»±c: Bearer Token Required.
Request (cURL):
Bash
curl http://localhost:3000/api/users/wallet \
-H "Authorization: Bearer YOUR_JWT_TOKEN"

Output (Success 200):
JSON
{
   "wallet_id": 1,
   "user_id": 1,
   "balance": "500000.00"
}

Logic Flutter:
* Há»c viÃªn: Gá»i trong wallet_screen.dart Ä‘á»ƒ hiá»ƒn thá»‹ sá»‘ dÆ° "500,000 VND".
* Gia sÆ°: Gá»i trong earnings_screen.dart Ä‘á»ƒ hiá»ƒn thá»‹ "Sá»‘ dÆ° Kháº£ dá»¥ng".
2.4. GET /api/users/saved-tutors
* MÃ´ táº£: (Há»c viÃªn) Láº¥y danh sÃ¡ch cÃ¡c gia sÆ° Ä‘Ã£ lÆ°u (yÃªu thÃ­ch).
* XÃ¡c thá»±c: Bearer Token Required (Chá»‰ Há»c viÃªn).
Request (cURL): (DÃ¹ng token cá»§a Há»c ViÃªn A (id: 1))
Bash
curl http://localhost:3000/api/users/saved-tutors \
-H "Authorization: Bearer YOUR_JWT_TOKEN"

Output (Success 200): (Há»c ViÃªn A Ä‘Ã£ lÆ°u Gia SÆ° D (id: 4))
JSON
[
   {
       "user_id": 4,
       "full_name": "Gia SÆ° D (Flutter)",
       "avatar_url": null,
       "bio": "Senior Flutter Developer táº¡i cÃ´ng ty X...",
       "price_per_hour": "350000.00",
       "average_rating": "0.00"
   }
]

Logic Flutter:
* Sá»­ dá»¥ng trong saved_tutors_screen.dart.
* Gá»i trong initState() Ä‘á»ƒ táº£i vÃ  hiá»ƒn thá»‹ danh sÃ¡ch ListView.

2.5. POST /api/users/saved-tutors
* MÃ´ táº£: (Há»c viÃªn) LÆ°u/YÃªu thÃ­ch má»™t gia sÆ°.
* XÃ¡c thá»±c: Bearer Token Required (Chá»‰ Há»c viÃªn).
Request (cURL): (Há»c ViÃªn A (id: 1) lÆ°u Gia SÆ° B (id: 2))
Bash
curl -X POST http://localhost:3000/api/users/saved-tutors \
-H "Authorization: Bearer YOUR_JWT_TOKEN" \
-H "Content-Type: application/json" \
-d '{
   "tutorId": 2
}'

Output (Success 201):
JSON
{
   "message": "ÄÃ£ lÆ°u gia sÆ°."
}

Logic Flutter:
* Sá»­ dá»¥ng trong tutor_profile_detail_screen.dart.
* Gá»i khi ngÆ°á»i dÃ¹ng báº¥m vÃ o biá»ƒu tÆ°á»£ng "trÃ¡i tim" (<3) trÃªn AppBar.
________________


3. ğŸ‘¨â€ğŸ« API Gia sÆ° (Tutor)
CÃ¡c API cÃ´ng khai Ä‘á»ƒ tÃ¬m kiáº¿m, vÃ  API riÃªng tÆ° cho Gia sÆ° quáº£n lÃ½.
3.1. GET /api/tutors


* MÃ´ táº£: API CÃ´ng khai. TÃ¬m kiáº¿m vÃ  lá»c danh sÃ¡ch gia sÆ° (cho Trang chá»§ vÃ  MÃ n hÃ¬nh lá»c).
* XÃ¡c thá»±c: KhÃ´ng cáº§n.
Request (cURL): (Lá»c cÃ¡c gia sÆ° dáº¡y "tin_hoc")
Bash
curl "http://localhost:3000/api/tutors?category=tin_hoc"

Output (Success 200):
JSON
[
   {
       "user_id": 4,
       "full_name": "Gia SÆ° D (Flutter)",
       "avatar_url": null,
       "bio": "Senior Flutter Developer táº¡i cÃ´ng ty X...",
       "price_per_hour": "350000.00",
       "average_rating": "0.00",
       "is_verified": false
   }
]

Logic Flutter:
* Sá»­ dá»¥ng trong home_screen.dart Ä‘á»ƒ táº£i cÃ¡c danh sÃ¡ch GridView (vÃ­ dá»¥: gá»i ...api/tutors?category=tin_hoc cho má»¥c "Gia sÆ° Tin há»c").
* Sá»­ dá»¥ng trong search_screen.dart khi ngÆ°á»i dÃ¹ng tÃ¬m kiáº¿m hoáº·c Ã¡p dá»¥ng bá»™ lá»c.


3.2. GET /api/tutors/:tutorId


* MÃ´ táº£: API CÃ´ng khai. Láº¥y há»“ sÆ¡ chi tiáº¿t cá»§a 1 gia sÆ°, bao gá»“m cáº£ mÃ´n há»c vÃ  Ä‘Ã¡nh giÃ¡.
* XÃ¡c thá»±c: KhÃ´ng cáº§n.
Request (cURL): (Xem há»“ sÆ¡ Gia SÆ° D (id: 4))
Bash
curl http://localhost:3000/api/tutors/4

Output (Success 200):
JSON


{
   "user_id": 4,
   "full_name": "Gia SÆ° D (Flutter)",
   "email": "giasu.d@email.com",
   "phone_number": "090777888",
   "avatar_url": null,
   "bio": "Senior Flutter Developer táº¡i cÃ´ng ty X...",
   "price_per_hour": "350000.00",
   "average_rating": "5.00",
   "is_verified": false,
   "subjects": [
       {
           "subject_id": 2,
           "name": "Láº­p trÃ¬nh Flutter",
           "category": "tin_hoc"
       },
       {
           "subject_id": 3,
           "name": "Tiáº¿ng Anh Giao tiáº¿p",
           "category": "ngoai_ngu"
       }
   ],
   "reviews": [
       {
           "review_id": 1,
           "rating": 5,
           "comment": "Tháº§y dáº¡y ráº¥t nhiá»‡t tÃ¬nh vÃ  dá»… hiá»ƒu!",
           "created_at": "...",
           "student_name": "Há»c ViÃªn C"
       }
   ]
}

Logic Flutter:
* ÄÃ¢y lÃ  API cá»‘t lÃµi cá»§a Há»c viÃªn.
* Sá»­ dá»¥ng trong tutor_profile_detail_screen.dart.
* Gá»i trong initState() vá»›i tutorId Ä‘Æ°á»£c truyá»n vÃ o, sau Ä‘Ã³ dÃ¹ng dá»¯ liá»‡u nÃ y Ä‘á»ƒ láº¥p Ä‘áº§y toÃ n bá»™ mÃ n hÃ¬nh (tÃªn, bio, cÃ¡c chip mÃ´n há»c, danh sÃ¡ch review...).

________________


4. ğŸ“š API MÃ´n há»c (Subject)
4.1. GET /api/subjects


* MÃ´ táº£: API CÃ´ng khai. Láº¥y táº¥t cáº£ cÃ¡c mÃ´n há»c, ká»¹ nÄƒng, trÃ¬nh Ä‘á»™...
* XÃ¡c thá»±c: KhÃ´ng cáº§n.
Request (cURL)
Bash




curl http://localhost:3000/api/subjects

Output (Success 200):
JSON
[
   {
       "subject_id": 2,
       "name": "Láº­p trÃ¬nh Flutter",
       "category": "tin_hoc"
   },
   {
       "subject_id": 4,
       "name": "Ká»¹ nÄƒng Thuyáº¿t trÃ¬nh",
       "category": "ky_nang_mem"
   },
   {
       "subject_id": 1,
       "name": "ToÃ¡n 12",
       "category": "pho_thong"
   },
   ...
]

Logic Flutter:
* Sá»­ dá»¥ng trong search_screen.dart.
* Gá»i API nÃ y khi ngÆ°á»i dÃ¹ng má»Ÿ "Bá»™ lá»c NÃ¢ng cao" (_AdvancedFilterContent).
* DÃ¹ng dá»¯ liá»‡u nÃ y Ä‘á»ƒ tá»± Ä‘á»™ng táº¡o ra cÃ¡c ChoiceChip (vÃ­ dá»¥: nhÃ³m táº¥t cáº£ category: 'tieu_hoc' láº¡i thÃ nh má»™t nhÃ³m lá»c).
________________


5. â­ API ÄÃ¡nh giÃ¡ (Review)
5.1. POST /api/reviews


* MÃ´ táº£: (Há»c viÃªn) ÄÄƒng má»™t Ä‘Ã¡nh giÃ¡ cho má»™t buá»•i há»c Ä‘Ã£ hoÃ n thÃ nh.
* XÃ¡c thá»±c: Bearer Token Required (Chá»‰ Há»c viÃªn).
Request (cURL): (Há»c ViÃªn C (id: 3) Ä‘Ã¡nh giÃ¡ buá»•i há»c (scheduleId: 1) cá»§a Gia SÆ° D (id: 4))


Bash




curl -X POST http://localhost:3000/api/reviews \
-H "Authorization: Bearer YOUR_JWT_TOKEN" \
-H "Content-Type: application/json" \
-d '{
   "tutorId": 4,
   "scheduleId": 1,
   "rating": 5,
   "comment": "Tháº§y dáº¡y Flutter ráº¥t tuyá»‡t vá»i!"
}'

Output (Success 201):
JSON


{
   "review_id": 2,
   "student_user_id": 3,
   "tutor_user_id": 4,
   "schedule_id": 1,
   "rating": 5,
   "comment": "Tháº§y dáº¡y Flutter ráº¥t tuyá»‡t vá»i!",
   "created_at": "..."
}

Output (Failure 400):
JSON


{
   "message": "Báº¡n khÃ´ng thá»ƒ Ä‘Ã¡nh giÃ¡ buá»•i há»c nÃ y (cÃ³ thá»ƒ do chÆ°a hoÃ n thÃ nh hoáº·c Ä‘Ã£ Ä‘Ã¡nh giÃ¡)."
}

Logic Flutter:
* Sá»­ dá»¥ng trong my_schedule_screen.dart.
* Sau khi má»™t buá»•i há»c cÃ³ status: 'completed', cho phÃ©p Há»c viÃªn báº¥m vÃ o vÃ  "ÄÃ¡nh giÃ¡".
* Gá»i API nÃ y khi Há»c viÃªn gá»­i Ä‘Ã¡nh giÃ¡.
________________


6. API Chat
6.1. GET /api/chat/rooms
* MÃ´ táº£: Láº¥y danh sÃ¡ch cÃ¡c phÃ²ng chat (Há»™p thÆ°) cá»§a ngÆ°á»i dÃ¹ng Ä‘ang Ä‘Äƒng nháº­p.
* XÃ¡c thá»±c: Bearer Token Required.
Request (cURL): (ÄÄƒng nháº­p báº±ng Gia SÆ° D (id: 4))
Bash


curl http://localhost:3000/api/chat/rooms \
-H "Authorization: Bearer YOUR_JWT_TOKEN"

Output (Success 200): (Gia SÆ° D Ä‘ang chat vá»›i Há»c ViÃªn C (id: 3))
JSON
[
   {
       "room_id": 1,
       "recipient_id": 3,
       "recipient_name": "Há»c ViÃªn C",
       "recipient_avatar": null
   }
]

Logic Flutter:
* Sá»­ dá»¥ng trong chat_list_screen.dart.
* Gá»i trong initState() Ä‘á»ƒ táº£i danh sÃ¡ch cÃ¡c cuá»™c trÃ² chuyá»‡n.
6.2. GET /api/chat/rooms/:roomId
* MÃ´ táº£: Láº¥y toÃ n bá»™ tin nháº¯n cá»§a má»™t phÃ²ng chat cá»¥ thá»ƒ.
* XÃ¡c thá»±c: Bearer Token Required.
Request (cURL):
Bash


curl http://localhost:3000/api/chat/rooms/1 \
-H "Authorization: Bearer YOUR_JWT_TOKEN"

Output (Success 200):
JSON
[
   {
       "message_id": 1,
       "room_id": 1,
       "sender_user_id": 3,
       "message_text": "Dáº¡ em chÃ o tháº§y, em lÃ  Há»c ViÃªn C.",
       "sent_at": "..."
   },
   {
       "message_id": 2,
       "room_id": 1,
       "sender_user_id": 4,
       "message_text": "ChÃ o em, tháº§y nháº­n Ä‘Æ°á»£c yÃªu cáº§u rá»“i. Em muá»‘n há»c vÃ o T3 hay T5?",
       "sent_at": "..."
   }
]

Logic Flutter:
* Sá»­ dá»¥ng trong chat_detail_screen.dart.
* Gá»i trong initState() (vÃ  dÃ¹ng StreamBuilder Ä‘á»ƒ nghe tin nháº¯n má»›i).


6.3. POST /api/chat/rooms/:roomId
* MÃ´ táº£: Gá»­i má»™t tin nháº¯n má»›i vÃ o phÃ²ng chat.
* XÃ¡c thá»±c: Bearer Token Required.
Request (cURL): (Gia SÆ° D (id: 4) gá»­i tin nháº¯n)
Bash


curl -X POST http://localhost:3000/api/chat/connect \
-H "Authorization: Bearer YOUR_JWT_TOKEN" \
-H "Content-Type: application/json" \
-d '{
    "tutorId": 4,
    "messageText": "ChÃ o Gia sÆ° D, mÃ¬nh muá»‘n há»c Flutter cáº¥p tá»‘c vÃ o cuá»‘i tuáº§n."
}'

Output (Success 201):
JSON
{
    "message": "Káº¿t ná»‘i thÃ nh cÃ´ng!",
    "data": {
        "room": {
            "room_id": 5,
            "user_one_id": 1,
            "user_two_id": 4,
            ...
        },
        "message": {
            "message_id": 10,
            "room_id": 5,
            "message_text": "ChÃ o Gia sÆ° D...",
            ...
        }
    }
}
Logic Flutter:
* Sá»­ dá»¥ng trong chat_detail_screen.dart.
* Gá»i khi ngÆ°á»i dÃ¹ng báº¥m nÃºt "Gá»­i".